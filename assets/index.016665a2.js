import{d as K,n as Z,p as J,q as Q,v as W,K as X,r as n,c as g,w as O,B as Y,a as k,e as t,y as U,C as b,t as w,m as $,F as ee,f as te,E as ae,u as E,i as le,H as se,j as ne,k as oe,o as m,h as ie}from"./index.e4ed90f9.js";import{_ as ce}from"./playlist-item.9d633811.js";import{g as ue,d as re}from"./playlist.733cfdb3.js";const ve={class:"sticky flex flex-col items-center overflow-hidden w-full transform top-16 mt-2",id:"playlist-info"},de={alt:"\u5C01\u9762",class:"h-48 w-48 object-cover align-bottom"},fe={class:"text-center w-full"},pe={class:"text-2xl mt-2 truncate px-2"},ge={class:"text-sm font-light mt-1 overflow-elision-2 px-2"},me={class:"w-full z-10 pt-4",id:"playlist-content"},ye={class:"pt-10 relative bg-gray-900"},_e={class:"space-y-2 pb-2"},he={class:"my-5 w-full text-center font-normal text-sm text-gray-400"},xe={key:1,class:"w-full text-lg h-full flex items-center justify-center"},Ce=K({__name:"index",async setup(ke){let i,d;const I=le(),j=se();Z(()=>{P()}),J(()=>{F()}),Q(()=>{P()}),W(()=>{F(),r.value=!1}),X(()=>{_.value=!1});const C=20,S=n(null),u=n([]),y=new IntersectionObserver(e=>{e.forEach(a=>{switch(a.target.getAttribute("data-flag")){case"SUF":a.isIntersecting&&(o.value.length?l.value=l.value.concat(o.value.splice(0,20)):!h.value&&R());break;case"PRE":r.value=!a.isIntersecting;break}})},{root:S.value,threshold:[0,1]}),r=n(!1),v=n(0),_=n(!0),l=n([]),f=n([]),s=n({}),o=n([]),h=n(!1),c=g(()=>I.state.player),M=g(()=>s.value.id===c.value.listId),B=g(()=>Number(j.params.id)),L=g(()=>o.value.length||v.value<f.value.length);try{if(B.value){const{data:e}=([i,d]=O(()=>ue(B.value)),i=await i,d(),i);s.value=e.playlist,f.value=s.value.trackIds,o.value=l.value.concat(s.value.tracks),v.value=o.value.length,o.value.length>10?l.value=o.value.splice(0,10):l.value=o.value}else{const{data:e}=([i,d]=O(()=>re()),i=await i,d(),i);l.value=e.data.dailySongs,s.value={id:0,name:"\u6BCF\u65E5\u63A8\u8350",description:`${I.state.userInfo.nickname}\u7684\u6BCF\u65E5\u4E13\u5C5E\u63A8\u8350\u6B4C\u66F2`,coverImgUrl:l.value[0].al.picUrl}}}catch{_.value=!1}async function R(){h.value=!0;const e=f.value.slice(v.value,v.value+C).map(a=>a.id).join(",");try{const{data:{songs:a}}=await Y(e);a&&(l.value=l.value.concat(a),v.value+=C)}catch(a){console.log(a)}finally{h.value=!1}}function N(){A(),c.value._playTrack()}function q(e){A(),c.value._playTrack(e)}function A(){c.value.listId!==s.value.id&&(c.value.trackList=l.value.concat(o.value),c.value.list=f.value,c.value.listId=s.value.id)}function D(e){u.value.push(e)}function P(){u.value.length&&u.value.forEach(e=>{y.observe(e)})}function F(){u.value.length&&(u.value.forEach(e=>{y.unobserve(e)}),y.disconnect())}function be(e){}return(e,a)=>{const x=ne("svg-icon"),V=oe("img");return _.value?(m(),k("div",{key:0,class:"playlist-wrapper w-full h-full overflow-y-scroll overflow-x-hidden relative",ref_key:"scrollBox",ref:S},[t("header",{class:b(["head-menu flex text-base h-14 sticky left-0 top-0 z-20 px-2 pt-4 m-0",r.value?"bg-gray-900":""])},[U(x,{name:"back",onClick:a[0]||(a[0]=p=>e.$router.go(-1))}),t("h2",{class:b(["flex-1 text-center mx-5 truncate opacity-0",{"opacity-100":r.value}])},w(s.value.name),3),U(x,{name:"more"})],2),t("figure",ve,[$(t("img",de,null,512),[[V,s.value.coverImgUrl+"?param=200y200"]]),t("figcaption",fe,[t("h1",pe,w(s.value.name),1),t("p",ge,w(s.value.description),1)])]),t("div",me,[t("div",{class:b(["btn-divider text-center h-6 sticky z-30 left-0 right-0 top-14 flex justify-center",{"bg-gray-900":r.value}])},[t("button",{class:"btn absolute -bottom-6 z-20 shadow-sm",type:"button",onClick:N},"\u64AD\u653E")],2),t("div",ye,[t("span",{class:"absolute -top-20 z-0",ref:D,"data-flag":"PRE"}),t("ul",_e,[(m(!0),k(ee,null,te(l.value,(p,G)=>{var T,z;return m(),ie(ce,{track:p,"is-playing":E(M)&&p.id===((z=(T=E(c))==null?void 0:T.currentTrack)==null?void 0:z.id),onOnPlay:H=>q(G),onOnMenu:H=>(p.id,void 0)},null,8,["track","is-playing","onOnPlay","onOnMenu"])}),256))])]),$(t("div",he,[t("span",{ref:D,"data-flag":"SUF"},"loading...")],512),[[ae,E(L)]])])],512)):(m(),k("div",xe,"\u52A0\u8F7D\u5931\u8D25~"))}}});export{Ce as default};
