import{d as N,r as a,c as d,n as S,p as D,q as $,v as P,x as T,a as i,u as e,F as b,e as l,m as G,t as O,y as C,h as I,b as x,f as V,i as Z,g as j,k as M,o as s,_ as R,L as q}from"./index.03c1f994.js";import{L as h}from"./index.d.a07b5bc4.js";import{_ as w}from"./cover.8d579c81.js";const z={key:0,class:"h-full flex-col flex"},Y={class:"bg-gray-800 shadow-lg py-4 px-2 w-full flex self-start items-center space-x-3"},H={alt:"\u5934\u50CF",class:"h-12 w-12 rounded-full relative z-10"},J={class:"flex-1"},K={class:"flex-1 overflow-y-auto flex flex-wrap px-2 py-4 justify-center"},Q={key:1,class:"text-center h-full flex flex-col space-y-3 justify-center px-2"},ae=N({__name:"index",setup(W){const m=Z(),p=j(),_=a(!1),y=a(!0),k=a(!0),n=a([]),g=a(0),o=a(null),c=d(()=>m.state.userInfo),v=d(()=>n.value.slice(0,1)),E=d(()=>n.value.slice(1)),U=d(()=>m.state.loginType),f=new IntersectionObserver((t,r)=>t[0].isIntersecting&&!_.value&&A());S(()=>{o.value&&f.observe(o.value)}),D(()=>{f.disconnect()}),$(()=>{o.value&&f.observe(o.value)}),P(()=>{f.disconnect()});async function A(){_.value=!0;try{const{data:t}=await T({uid:c.value.userId,limit:10,offset:g.value});y.value=t.more,n.value=n.value.concat(t.playlist),g.value+=10}catch(t){console.log(t),k.value=!1}finally{_.value=!1}}async function B(){await m.dispatch("logout"),n.value=[],g.value=0,y.value=!0,p.replace("/library")}return(t,r)=>{const F=M("img");return k.value?(s(),i("div",z,[e(c).userId?(s(),i(b,{key:0},[l("header",Y,[G(l("img",H,null,512),[[F,e(c).avatarUrl+"?param=56y56"]]),l("h2",J,O(e(c).nickname)+"\u7684\u6B4C\u5355",1),C(R,{onClick:B,name:"logout"})]),l("ul",K,[e(U)===e(h).ACCOUNT&&e(v).length?(s(),I(w,{key:0,class:"mt-3 mx-3",name:e(v)[0].name,"pic-url":e(v)[0].coverImgUrl,id:e(v)[0].id},null,8,["name","pic-url","id"])):x("",!0),(s(!0),i(b,null,V(e(E),(u,L)=>(s(),I(w,{class:"mt-3 mx-3",key:L,name:u.name,"pic-url":u.coverImgUrl,id:u.id},null,8,["name","pic-url","id"]))),128)),y.value?(s(),i("li",{key:1,class:"my-2 py-2 w-full text-center",ref_key:"trigger",ref:o},[C(q)],512)):x("",!0)])],64)):(s(),i("div",Q,[l("button",{class:"btn-primary",type:"button",onClick:r[0]||(r[0]=u=>e(p).push(`/login/${e(h).ACCOUNT}`))},"\u8D26\u53F7\u767B\u5F55"),l("button",{class:"btn-primary",type:"button",onClick:r[1]||(r[1]=u=>e(p).push(`/login/${e(h).USERNAME}`))},"\u6635\u79F0\u767B\u5F55")]))])):x("",!0)}}});export{ae as default};
